<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ngme2">
<title>Comparing Ngme2 with R-INLA • ngme2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Roboto_Slab-0.4.5/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comparing Ngme2 with R-INLA">
<meta property="og:description" content="ngme2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ngme2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/ngme2.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/Installation_and_configuration.html">Installation and configuration</a>
    <a class="dropdown-item" href="../articles/inla_compare.html">Comparison with R-INLA</a>
    <a class="dropdown-item" href="../articles/AR1-model.html">AR(1) model</a>
    <a class="dropdown-item" href="../articles/RW-model.html">Random walk model</a>
    <a class="dropdown-item" href="../articles/SPDE-model.html">SPDE Matern model</a>
    <a class="dropdown-item" href="../articles/pred_and_est.html">Model prediction and estimation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/davidbolin/ngme2" aria-label="Github">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/jdavidbolin" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Comparing Ngme2 with R-INLA</h1>
            
      
      
      <div class="d-none name"><code>inla_compare.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="description">Description<a class="anchor" aria-label="anchor" href="#description"></a>
</h2>
<p>R-INLA (<a href="https://www.r-inla.org" class="external-link uri">https://www.r-inla.org</a>) is a package in R that do
approximate Bayesian inference for Latent Gaussian Models. Ngme2 follows
similar structure but we allow non-Gaussian latent models (Latent
non-Gaussian Models). In this vignette, we will introduce the basic
usage of Ngme2 package and compare it with R-INLA.</p>
</div>
<div class="section level2">
<h2 id="load-data-and-create-mesh">Load data and create mesh<a class="anchor" aria-label="anchor" href="#load-data-and-create-mesh"></a>
</h2>
<p>In this example, we will use the mcycle data, which is a data set of
motorcycle acceleration times. The data set is available in the MASS
package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidbolin.github.io/ngme2/">ngme2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mcycle</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mcycle</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    133 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;  $ times: num  2.4 2.6 3.2 3.6 4 6.2 6.6 6.8 7.8 8.2 ...</span></span>
<span><span class="co">#&gt;  $ accel: num  0 -1.3 -2.7 0 -2.7 -2.7 -2.7 -1.3 -2.7 -2.7 ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">mcycle</span>, <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">times</span>, <span class="va">accel</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="inla_compare_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Next we will create the mesh, in order to use the SPDE model. The
mesh is created by the function <code>inla.mesh.1d</code>. The first
argument is the location of the mesh points. The second argument is the
maximum edge length.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.1d.html" class="external-link">inla.mesh.1d</a></span><span class="op">(</span><span class="va">mcycle</span><span class="op">$</span><span class="va">times</span>, max.edge<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mesh</span><span class="op">$</span><span class="va">n</span></span>
<span><span class="co">#&gt; [1] 94</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="compare-results-in-inla-and-ngme2">Compare results in INLA and Ngme2<a class="anchor" aria-label="anchor" href="#compare-results-in-inla-and-ngme2"></a>
</h2>
<div class="section level3">
<h3 id="fit-the-model-with-inla">Fit the model with INLA<a class="anchor" aria-label="anchor" href="#fit-the-model-with-inla"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit use INLA</span></span>
<span><span class="va">spde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde2.matern.html" class="external-link">inla.spde2.matern</a></span><span class="op">(</span><span class="va">mesh</span>, alpha<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde.make.A.html" class="external-link">inla.spde.make.A</a></span><span class="op">(</span><span class="va">mesh</span>, loc<span class="op">=</span><span class="va">mcycle</span><span class="op">$</span><span class="va">times</span><span class="op">)</span></span>
<span><span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde.make.index.html" class="external-link">inla.spde.make.index</a></span><span class="op">(</span><span class="st">"time"</span>, <span class="va">spde</span><span class="op">$</span><span class="va">n.spde</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>accel <span class="op">=</span> <span class="va">mcycle</span><span class="op">$</span><span class="va">accel</span>, time <span class="op">=</span> <span class="va">ind</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span><span class="va">result_inla</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span></span>
<span>  <span class="va">accel</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="va">time</span>, model<span class="op">=</span><span class="va">spde</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">A</span><span class="op">)</span>,</span>
<span>  control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>config<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s check the estimation of SPDE model parameters</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spde_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde.result.html" class="external-link">inla.spde.result</a></span><span class="op">(</span><span class="va">result_inla</span>, <span class="st">"time"</span>, <span class="va">spde</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># posterior mode of kappa</span></span>
<span><span class="va">post_mode_kappa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">spde_res</span><span class="op">$</span><span class="va">marginals.kappa</span>,</span>
<span>  <span class="va">kappa.1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">kappa.1</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spde_res</span><span class="op">$</span><span class="va">marginals.kappa</span><span class="op">$</span><span class="va">kappa.1</span>,</span>
<span>  type<span class="op">=</span><span class="st">"l"</span>, main<span class="op">=</span><span class="st">"kappa"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">post_mode_kappa</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="inla_compare_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_mode_kappa</span></span>
<span><span class="co">#&gt;         x </span></span>
<span><span class="co">#&gt; 0.1994212</span></span>
<span></span>
<span><span class="co"># posterior mode of tau</span></span>
<span><span class="va">post_mode_tau</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">spde_res</span><span class="op">$</span><span class="va">marginals.tau</span>,</span>
<span>  <span class="va">tau.1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">tau.1</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spde_res</span><span class="op">$</span><span class="va">marginals.tau</span><span class="op">$</span><span class="va">tau.1</span>, type<span class="op">=</span><span class="st">"l"</span>, main<span class="op">=</span><span class="st">"tau"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">post_mode_tau</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="inla_compare_files/figure-html/unnamed-chunk-5-2.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">/</span> <span class="va">post_mode_tau</span> <span class="co"># for comparison with Ngme2 (same as sigma parameter in Ngme2)</span></span>
<span><span class="co">#&gt;        x </span></span>
<span><span class="co">#&gt; 10.20411</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-1d-spde-model-with-ngme2">Fit 1d SPDE model with Ngme2<a class="anchor" aria-label="anchor" href="#fit-1d-spde-model-with-ngme2"></a>
</h3>
<p>Next we do similar thing with Ngme2.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spde_ngme</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_matern.html">model_matern</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">2</span>, mesh <span class="op">=</span> <span class="va">mesh</span>, loc <span class="op">=</span> <span class="va">mcycle</span><span class="op">$</span><span class="va">times</span><span class="op">)</span></span>
<span><span class="va">result_ngme</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ngme.html">ngme</a></span><span class="op">(</span></span>
<span>  <span class="va">accel</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">spde_ngme</span>, name<span class="op">=</span><span class="st">"myspde"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mcycle</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"normal"</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="../reference/ngme_control.html">ngme_control</a></span><span class="op">(</span></span>
<span>    iterations <span class="op">=</span> <span class="fl">1000</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting estimation... </span></span>
<span><span class="co">#&gt; Estimation done!</span></span>
<span><span class="va">result_ngme</span></span>
<span><span class="co">#&gt; *** Ngme object ***</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects: </span></span>
<span><span class="co">#&gt;    No fixed effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Measurement noise: </span></span>
<span><span class="co">#&gt;   Noise type - normal</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       sigma = 23.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Latent models: </span></span>
<span><span class="co">#&gt; $myspde</span></span>
<span><span class="co">#&gt;   Ngme model: matern</span></span>
<span><span class="co">#&gt;   Model parameters: </span></span>
<span><span class="co">#&gt;       kappa = 0.239</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Noise type - normal</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       sigma = 7.71</span></span></code></pre></div>
<p>Here, we can directly read the estimation of kappa and sigma (1/tau)
as shown in the result.</p>
</div>
<div class="section level3">
<h3 id="compare-the-results">Compare the results<a class="anchor" aria-label="anchor" href="#compare-the-results"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">mcycle</span>, <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">times</span>, <span class="va">accel</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">$</span><span class="va">loc</span>, <span class="va">result_inla</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">time</span><span class="op">[</span>, <span class="st">"mean"</span><span class="op">]</span>, col<span class="op">=</span><span class="fl">2</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">postW</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">result_ngme</span>, loc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>myspde <span class="op">=</span> <span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">$</span><span class="va">loc</span>, <span class="va">postW</span>, col<span class="op">=</span><span class="fl">3</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Posterior mean with Ngme2 and INLA"</span><span class="op">)</span></span>
<span><span class="co"># One can add some quantile band to the plot using Ngme2</span></span>
<span><span class="va">postW_q25</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">result_ngme</span>, loc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>myspde <span class="op">=</span> <span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">)</span>, estimator<span class="op">=</span><span class="st">"quantile"</span>, q<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="va">postW_q75</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">result_ngme</span>, loc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>myspde <span class="op">=</span> <span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">)</span>, estimator<span class="op">=</span><span class="st">"quantile"</span>, q<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">$</span><span class="va">loc</span>, <span class="va">postW_q25</span>, col<span class="op">=</span><span class="fl">4</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">$</span><span class="va">loc</span>, <span class="va">postW_q75</span>, col<span class="op">=</span><span class="fl">5</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"INLA"</span>, <span class="st">"Ngme2"</span>, <span class="st">"Ngme2 25%"</span>, <span class="st">"Ngme2 75%"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="inla_compare_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="extend-model-to-non-gaussian-case">Extend model to non-Gaussian case<a class="anchor" aria-label="anchor" href="#extend-model-to-non-gaussian-case"></a>
</h2>
<p>The Ngme2 package allows us to fit non-Gaussian latent models. We can
easily extend the model to non-Gaussian case by changing the
<code>noise</code> argument, and we can start from previous result using
<code>start</code> argument.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># refit the model using nig noise</span></span>
<span><span class="va">result_ngme2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ngme.html">ngme</a></span><span class="op">(</span></span>
<span>  <span class="va">accel</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">spde_ngme</span>, name<span class="op">=</span><span class="st">"myspde"</span>, noise<span class="op">=</span><span class="fu"><a href="../reference/ngme_noise.html">noise_nig</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mcycle</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"normal"</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="../reference/ngme_control.html">ngme_control</a></span><span class="op">(</span></span>
<span>    n_parallel_chain <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    iterations <span class="op">=</span> <span class="fl">2000</span></span>
<span>  <span class="op">)</span>,</span>
<span>  start <span class="op">=</span> <span class="va">result_ngme</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting estimation... </span></span>
<span><span class="co">#&gt; Estimation done!</span></span>
<span><span class="va">result_ngme2</span></span>
<span><span class="co">#&gt; *** Ngme object ***</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects: </span></span>
<span><span class="co">#&gt;    No fixed effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Measurement noise: </span></span>
<span><span class="co">#&gt;   Noise type - normal</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       sigma = 24.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Latent models: </span></span>
<span><span class="co">#&gt; $myspde</span></span>
<span><span class="co">#&gt;   Ngme model: matern</span></span>
<span><span class="co">#&gt;   Model parameters: </span></span>
<span><span class="co">#&gt;       kappa = 0.282</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Noise type - nig</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       mu = -2.13</span></span>
<span><span class="co">#&gt;       sigma = 12.9</span></span>
<span><span class="co">#&gt;       nu = 0.198</span></span>
<span><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">result_ngme2</span>, <span class="st">"myspde"</span><span class="op">)</span></span></code></pre></div>
<p><img src="inla_compare_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result_ngme2</span><span class="op">$</span><span class="va">latents</span><span class="op">[[</span><span class="st">"myspde"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">noise</span><span class="op">)</span></span></code></pre></div>
<p><img src="inla_compare_files/figure-html/unnamed-chunk-8-2.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="doing-prediction-with-ngme2">Doing prediction with Ngme2<a class="anchor" aria-label="anchor" href="#doing-prediction-with-ngme2"></a>
</h2>
<p>Doing prediction at unknown location in INLA would require much more
effort, we will skip it (since it’s not the main focus). While in Ngme2,
it can be done in just one line of code.</p>
<p>First we need to create a new mesh for prediction.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mcycle</span><span class="op">$</span><span class="va">times</span><span class="op">)</span></span>
<span><span class="va">rg</span></span>
<span><span class="co">#&gt; [1]  2.4 57.6</span></span>
<span><span class="va">locs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="va">rg</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, to<span class="op">=</span><span class="va">rg</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>Next, we call the <code>predict</code> function with <code>loc</code>
argument provided with a list of new locations (for each latent
model).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># similar to the posterior mean in previous section</span></span>
<span><span class="va">prd_ngme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">result_ngme2</span>, loc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>myspde<span class="op">=</span><span class="va">locs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">mcycle</span>, <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">times</span>, <span class="va">accel</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">locs</span>, <span class="va">prd_ngme</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Prediction at unknown locations"</span><span class="op">)</span></span></code></pre></div>
<p><img src="inla_compare_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Bolin, Xiaotian Jin, Alexandre Simas, Jonas Wallin.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
