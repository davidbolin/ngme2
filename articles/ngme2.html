<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ngme2">
<title>Ngme2 - A new Flexible R Package for Latent non-Gaussian Models • ngme2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Roboto_Slab-0.4.5/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Ngme2 - A new Flexible R Package for Latent non-Gaussian Models">
<meta property="og:description" content="ngme2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ngme2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/ngme2.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/Installation_and_configuration.html">Installation and configuration</a>
    <a class="dropdown-item" href="../articles/inla_compare.html">Comparison with R-INLA</a>
    <a class="dropdown-item" href="../articles/AR1-model.html">AR(1) model</a>
    <a class="dropdown-item" href="../articles/RW-model.html">Random walk model</a>
    <a class="dropdown-item" href="../articles/SPDE-model.html">SPDE Matern model</a>
    <a class="dropdown-item" href="../articles/replicate.html">Ngme replicate feature</a>
    <a class="dropdown-item" href="../articles/pred_and_est.html">Model prediction and estimation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/davidbolin/ngme2" aria-label="Github">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/jdavidbolin" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Ngme2 - A new Flexible R Package for Latent non-Gaussian Models</h1>
            
            <h4 data-toc-skip class="date">2023-03-22</h4>
      
      
      <div class="d-none name"><code>ngme2.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we provide a brief introduction to the
<code>ngme2</code> package.</p>
<p><code>ngme2</code> is the updated version of R Package
<code>ngme</code> (<a href="https://github.com/davidbolin/ngme" class="external-link uri">https://github.com/davidbolin/ngme</a>), a package for
estimating latent non-Gaussian models. It follows a <strong>3-layer
structure</strong> in design (the general block model, latent process
models, and noises) for specifying the whole statistical model. The
latent process defines different operator structure, and the block model
collects them together with the fixed effects and measurement noise.</p>
<div class="section level3">
<h3 id="features">1 Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Support spatial models like Matern model with non-Gaussian
noise.</li>
<li>Support models for temporal data like <strong>AR1</strong> and
<strong>random walk</strong> of order 1 and 2.</li>
<li>Support replicate at same locations.</li>
<li>Support prediction at unknown locations.</li>
<li>Model corss-validation.</li>
<li>Comparing to the previous version, it now supports multiple
stochastic processes in the latent model.</li>
</ol>
</div>
<div class="section level3">
<h3 id="model-framework">2 Model Framework<a class="anchor" aria-label="anchor" href="#model-framework"></a>
</h3>
<p>The package <code>ngme2</code> provides methods for mixed effect
models both for single response variable case and multivariate response
case (not yet).</p>
<p>1.For <strong>single response</strong> case, it has the following
form: <span class="math display">\[
\begin{aligned}
Y = {\bf X}^{\top} {\bf \beta} + \sum_j {\bf A}_j W_j({\bf t}) +
\epsilon.
\end{aligned}
\]</span></p>
<p>Here,</p>
<ul>
<li>
<span class="math inline">\(Y\)</span> is the response
variable,</li>
<li>
<span class="math inline">\({\bf X}\)</span> is the matrix of fixed
effects explanatory variables,</li>
<li>
<span class="math inline">\({\bf \beta}\)</span> is the matrix of
fixed effects coefficients,</li>
<li>
<span class="math inline">\({\bf A}_j\)</span> is the observation
matrix for each process,</li>
<li>
<span class="math inline">\(W_j(t_j)\)</span> is specified as a
stochastic process,</li>
<li>
<span class="math inline">\(\epsilon\)</span> is measurement
error.</li>
</ul>
<p>Here, the process <span class="math inline">\(W\)</span> follows
<span class="math inline">\({\bf K} W = z\)</span>, where <span class="math inline">\(z\)</span> is either Gaussian or non-Gaussian
noise. <span class="math inline">\({\bf K}\)</span> is the operator
matrix.</p>
<p>Here is a simple template for using the core function
<code>ngme</code> to model the single response:</p>
<pre><code><span><span class="fu"><a href="../reference/ngme.html">ngme</a></span><span class="op">(</span></span>
<span>  formula<span class="op">=</span><span class="va">Y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="va">index</span>, model<span class="op">=</span><span class="st">"ar"</span>, noise<span class="op">=</span><span class="st">"nig"</span><span class="op">)</span>,</span>
<span>  data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">Y</span>, x1<span class="op">=</span><span class="va">x1</span>, x2<span class="op">=</span><span class="va">x2</span>, index<span class="op">=</span><span class="va">index</span><span class="op">)</span>,</span>
<span>  noise <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_normal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
<p>Here, function <code>f</code> is for modeling the stochastic process
W with Gaussian or non-Gaussian noise, we will discuss this later.
<code>noise</code> stands for the measurement noise distribution. In
this case, the model will have a Gaussian likelihood.</p>
<p>For <strong>multivariate response</strong> case, it has the following
form:</p>
<p>Here is a another template for using the core function
<code>ngme</code> to model the bivariate response:</p>
<pre><code><span><span class="fu"><a href="../reference/ngme.html">ngme</a></span><span class="op">(</span></span>
<span>  formula<span class="op">=</span><span class="va">Y1</span> <span class="op">|</span> <span class="va">Y2</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="va">index</span>, model<span class="op">=</span><span class="st">"ar"</span>, noise<span class="op">=</span><span class="st">"nig"</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="va">time</span>, model<span class="op">=</span><span class="st">"matern"</span><span class="op">)</span>,</span>
<span>  data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">Y</span>, x1<span class="op">=</span><span class="va">x1</span>, x2<span class="op">=</span><span class="va">x2</span>, index<span class="op">=</span><span class="va">index</span>, time<span class="op">=</span><span class="va">time</span><span class="op">)</span>,</span>
<span>  family<span class="op">=</span><span class="st">"normal"</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="non-gaussian-model">3 Non-Gaussian Model<a class="anchor" aria-label="anchor" href="#non-gaussian-model"></a>
</h3>
<p>Here we assume the non-Gaussian process is a type-G Lévy process,
whose increments can be represented as location-scale mixtures: <span class="math display">\[\gamma + \mu V + \sigma \sqrt{V}Z,\]</span> where
<span class="math inline">\(\gamma, \mu, \sigma\)</span> are parameters,
<span class="math inline">\(Z\sim N(0,1)\)</span> and is independent of
<span class="math inline">\(V\)</span>, and <span class="math inline">\(V\)</span> is a positive infinitely divisible
random variable. It results in the following form, where <span class="math inline">\(K\)</span> is the operator part:</p>
<p><span class="math display">\[
KW|V \sim N(\gamma + \mu V, \sigma^2 \, diag(V)),
\]</span> also, <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span> can be non-stationary.</p>
<p>In <code>ngme2</code>, we focus mainly on the normal inverse Gaussian
(NIG) model. See <code><a href="../reference/nig.html">?nig</a></code> for more details.</p>
</div>
<div class="section level3">
<h3 id="parameter-estimation">4 Parameter Estimation<a class="anchor" aria-label="anchor" href="#parameter-estimation"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Ngme2 does maximum likelihood estimation through preconditioned
stochastic gradient descent.</li>
<li>Multiple chains are run in parallel for better convergence
checks.</li>
</ol>
<!-- See `vignette()` for more details. -->
</div>
</div>
<div class="section level2">
<h2 id="ngme-model-structure">Ngme Model Structure<a class="anchor" aria-label="anchor" href="#ngme-model-structure"></a>
</h2>
<div class="section level3">
<h3 id="specify-noise-with-ngme_noise-object">Specify noise with <code>ngme_noise</code> object<a class="anchor" aria-label="anchor" href="#specify-noise-with-ngme_noise-object"></a>
</h3>
<p>The <code>ngme_noise</code> object is the most fundamental structure
in <code>ngme2</code>. The object is used to specify the driving noise
of the stochastic process and the measurement noise.</p>
<p>For now we support two noises, one is <strong>normal</strong> noise,
the other is the <strong>NIG</strong> noise.</p>
<p>The R class <code>ngme_noise</code> has the following interface:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidbolin.github.io/ngme2/">ngme2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ngme_noise.html">noise_normal</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>                 <span class="co"># normal noise</span></span>
<span><span class="co">#&gt; Noise type - normal</span></span>
<span><span class="co">#&gt; Noise parameters: </span></span>
<span><span class="co">#&gt;     sigma = 1</span></span>
<span><span class="fu"><a href="../reference/ngme_noise.html">noise_nig</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fl">1</span>, sigma <span class="op">=</span> <span class="fl">2</span>, nu <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># nig noise</span></span>
<span><span class="co">#&gt; Noise type - nig</span></span>
<span><span class="co">#&gt; Noise parameters: </span></span>
<span><span class="co">#&gt;     mu = 1</span></span>
<span><span class="co">#&gt;     sigma = 2</span></span>
<span><span class="co">#&gt;     nu = 1</span></span>
<span><span class="fu"><a href="../reference/ngme_noise.html">noise_nig</a></span><span class="op">(</span>            <span class="co"># non-stationary nig noise</span></span>
<span>  B_mu<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  theta_mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  B_sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  theta_sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>  nu <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Noise type - nig</span></span>
<span><span class="co">#&gt; Noise parameters: </span></span>
<span><span class="co">#&gt;     theta_mu = 1, 2</span></span>
<span><span class="co">#&gt;     theta_sigma = 1, 2</span></span>
<span><span class="co">#&gt;     nu = 1</span></span></code></pre></div>
<p>The 3rd example is the non-stationary NIG noise, where <span class="math inline">\(\mu = \bf B_{\mu} \bf \theta_{\mu}\)</span>, and
<span class="math inline">\(\sigma = \exp(\bf B_{\sigma} \bf
\theta_{\sigma})\)</span>.</p>
<pre><code><span><span class="fu"><a href="../reference/ngme_noise.html">ngme_noise</a></span><span class="op">(</span></span>
<span>  <span class="va">type</span>,           <span class="co"># the type of noise</span></span>
<span>  <span class="va">theta_mu</span>,       <span class="co"># mu parameter</span></span>
<span>  <span class="va">theta_sigma</span>,    <span class="co"># sigma parameter</span></span>
<span>  <span class="va">nu</span>,        <span class="co"># nu parameter</span></span>
<span>  <span class="va">B_mu</span>,           <span class="co"># basis matrix for non-stationary mu</span></span>
<span>  <span class="va">B_sigma</span>         <span class="co"># basis matrix for non-stationary sigma</span></span>
<span><span class="op">)</span></span></code></pre>
<p>It will construct the following noise structure:</p>
<p><span class="math display">\[
  - \mathbf{\mu} + \mathbf{\mu} V + \mathbf{\sigma} \sqrt{V} Z
\]</span></p>
<p>where <span class="math inline">\(\mu = \bf B_{\mu} \bf
\theta_{\mu}\)</span>, and <span class="math inline">\(\sigma = \exp(\bf
B_{\sigma} \bf \theta_{\sigma})\)</span>. In this case, we can recover
gaussian noise by setting <strong>type=“normal</strong> and ignoring
<strong>theta_mu</strong> and <strong>nu</strong>. Or we can simply use
helper function <code>noise_normal(sd=1)</code></p>
</div>
<div class="section level3">
<h3 id="specify-stochastic-process-with-f-function">Specify stochastic process with <code>f</code> function<a class="anchor" aria-label="anchor" href="#specify-stochastic-process-with-f-function"></a>
</h3>
<p>The middle layer is the stochastic process, in R interface, it is
represented as a <code>f</code> function. The process can be specified
by different noise structure. See <code>?ngme_model_types()</code> for
more details.</p>
<p>Some examples of using <code>f</code> function to specify
<code>ngme_model</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ngme2</span><span class="fu">::</span><span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, model <span class="op">=</span> <span class="st">"ar1"</span>,</span>
<span>  noise <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_nig</a></span><span class="op">(</span><span class="op">)</span>, theta_K <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co">#&gt; ngme2::f(model = "ar1", map = 1:10, noise = noise_nig(), theta_K = 0.5, </span></span>
<span><span class="co">#&gt;     name = "field", replicate = c(1, 1, 1, 1, 1, 1, 1, 1, 1, </span></span>
<span><span class="co">#&gt;     1))</span></span></code></pre></div>
<p>One useful model would be the SPDE model with Gaussian or
non-Gaussian noise, see the vignette for details.</p>
</div>
<div class="section level3">
<h3 id="specifying-latent-models-with-formula-in-ngme">Specifying latent models with formula in <code>ngme</code><a class="anchor" aria-label="anchor" href="#specifying-latent-models-with-formula-in-ngme"></a>
</h3>
<p>The latent model can be specified additively as a
<strong>formula</strong> argument in <code>ngme</code> function together
with <strong>fixed effects</strong>.</p>
<p>We use R formula to specify the latent model. We can specify the
model using <code>f</code> within the formula.</p>
<p>For example, the following formula</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">Y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span></span>
<span>    <span class="va">x2</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"ar1"</span>,</span>
<span>    noise <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_nig</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    theta_K <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"rw"</span>,</span>
<span>    order <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    circular <span class="op">=</span> <span class="cn">T</span>,</span>
<span>    noise <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_normal</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>corresponds to the model</p>
<p><span class="math display">\[
Y = \beta_0 + \beta_1 x_1 + W_1(x_2) + W_2(x_3) + \epsilon,
\]</span> where <span class="math inline">\(W_1\)</span> is an AR(1)
process, <span class="math inline">\(W_2\)</span> is a random walk 1
process. <span class="math inline">\(x_2\)</span> is random effects.. .
By default, we have intercept. The distribution of the measurement error
<span class="math inline">\(\epsilon\)</span> is given in the
<code>ngme</code> function.</p>
<p>The entire model can be fitted, along with the specification of the
distribution of the measurement error through the <code>ngme</code>
function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ngme.html">ngme</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">formula</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_normal</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, x1 <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">6</span>, x2 <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>,</span>
<span>  control_opt <span class="op">=</span> <span class="fu"><a href="../reference/control_opt.html">control_opt</a></span><span class="op">(</span></span>
<span>    estimation <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; *** Ngme object ***</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects: </span></span>
<span><span class="co">#&gt;    beta = -1,  1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Measurement noise: </span></span>
<span><span class="co">#&gt;   Noise type - normal</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       sigma = 0.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Latent models: </span></span>
<span><span class="co">#&gt; $field1</span></span>
<span><span class="co">#&gt;   Ngme model: ar1</span></span>
<span><span class="co">#&gt;   Model parameters: </span></span>
<span><span class="co">#&gt;       alpha = 0.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Noise type - nig</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       mu = 0</span></span>
<span><span class="co">#&gt;       sigma = 1</span></span>
<span><span class="co">#&gt;       nu = 1</span></span>
<span><span class="co">#&gt; $field2</span></span>
<span><span class="co">#&gt;   Ngme model: rw1</span></span>
<span><span class="co">#&gt;   Model parameters: </span></span>
<span><span class="co">#&gt;       No parameter.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Noise type - normal</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       sigma = 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of replicates is  1</span></span></code></pre></div>
<p>It gives the <code>ngme</code> object, which has three parts:</p>
<ol style="list-style-type: decimal">
<li>Fixed effects (intercept and x1)</li>
<li>Measurement noise (normal noise)</li>
<li>Latent models (contains 2 models, ar1 and rw1)</li>
</ol>
<p>We can turn the <code>estimation = TRUE</code> to start estimating
the model.</p>
</div>
</div>
<div class="section level2">
<h2 id="a-simple-example---ar1-process-with-nig-noise">A simple example - AR1 process with nig noise<a class="anchor" aria-label="anchor" href="#a-simple-example---ar1-process-with-nig-noise"></a>
</h2>
<p>Now let’s see an example of an AR1 process with nig noise. The
process is defined as</p>
<p><span class="math display">\[
W_i = \alpha W_{i-1} + \epsilon_i,
\]</span> Here, <span class="math inline">\(\epsilon_1,
..,\epsilon_n\)</span> is the iid <strong>NIG</strong> noise. And, it is
easy to verify that <span class="math display">\[ K{\bf W} =
\boldsymbol\epsilon,\]</span> where <span class="math display">\[
K =
  \begin{bmatrix}
    \alpha \\
    -1 &amp;  \alpha \\
    &amp; \ddots &amp; \ddots \\
    &amp; &amp; -1 &amp;  \alpha
  \end{bmatrix}
\]</span></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_obs</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">sigma_eps</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">mu</span> <span class="op">=</span> <span class="fl">2</span>; <span class="va">delta</span> <span class="op">=</span> <span class="op">-</span><span class="va">mu</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">nu</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># First we generate V. V_i follows inverse Gaussian distribution</span></span>
<span><span class="va">trueV</span> <span class="op">&lt;-</span> <span class="fu">ngme2</span><span class="fu">::</span><span class="fu"><a href="../reference/ig.html">rig</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="va">nu</span>, <span class="va">nu</span>, seed <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Then generate the nig noise</span></span>
<span><span class="va">mynoise</span> <span class="op">&lt;-</span> <span class="va">delta</span> <span class="op">+</span> <span class="va">mu</span><span class="op">*</span><span class="va">trueV</span> <span class="op">+</span> <span class="va">sigma</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">trueV</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span></span>
<span><span class="va">trueW</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">{</span><span class="va">y</span> <span class="op">+</span> <span class="va">alpha</span><span class="op">*</span><span class="va">x</span><span class="op">}</span>, <span class="va">mynoise</span>, accumulate <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">=</span> <span class="va">trueW</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_obs</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="va">sigma_eps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add some fixed effects</span></span>
<span><span class="va">x1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span><span class="op">)</span><span class="op">)</span>  <span class="co"># design matrix</span></span>
<span><span class="va">Y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">+</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s fit the model using <code>ngme</code>. Here we can use
<code>control_opt</code> to modify the control variables for the
<code>ngme</code>. See <code><a href="../reference/control_opt.html">?control_opt</a></code> for more optioins.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># # Fit the model with the AR1 model</span></span>
<span><span class="va">ngme_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ngme.html">ngme</a></span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span></span>
<span>    <span class="fl">1</span><span class="op">:</span><span class="va">n_obs</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"my_ar"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"ar1"</span>,</span>
<span>    noise <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_nig</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    theta_K <span class="op">=</span> <span class="fl">0.9</span>  <span class="co"># starting point for the alpha (parameter of K)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x1<span class="op">=</span><span class="va">x1</span>, x2<span class="op">=</span><span class="va">x2</span>, Y<span class="op">=</span><span class="va">Y</span><span class="op">)</span>,</span>
<span>  control_opt <span class="op">=</span> <span class="fu"><a href="../reference/control_opt.html">control_opt</a></span><span class="op">(</span></span>
<span>    burnin <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    iterations <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    std_lim <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>    n_parallel_chain <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    stop_points <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    print_check_info <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">3</span></span>
<span>    <span class="co"># verbose = T</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting estimation... </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Starting posterior sampling... </span></span>
<span><span class="co">#&gt; Note: Use ngme$latents[[model_name]]$W  to access the posterior mean of process </span></span>
<span><span class="co">#&gt; Posterior sampling done!</span></span></code></pre></div>
<p>Next we can read the result directly from the object.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ngme_out</span></span>
<span><span class="co">#&gt; *** Ngme object ***</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects: </span></span>
<span><span class="co">#&gt;    beta = -2.77, -1.59,  2.01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Measurement noise: </span></span>
<span><span class="co">#&gt;   Noise type - normal</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       sigma = 1.83</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Latent models: </span></span>
<span><span class="co">#&gt; $my_ar</span></span>
<span><span class="co">#&gt;   Ngme model: ar1</span></span>
<span><span class="co">#&gt;   Model parameters: </span></span>
<span><span class="co">#&gt;       alpha = 0.887</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Noise type - nig</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       mu = 0.324</span></span>
<span><span class="co">#&gt;       sigma = 2.19</span></span>
<span><span class="co">#&gt;       nu = 0.878</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of replicates is  1</span></span></code></pre></div>
<p>As we can see, the model converges in 350 iterations. The estimation
results are close to the real parameter.</p>
<p>We can also use the <code>traceplot</code> function to see the
estimation traceplot.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">ngme_out</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ngme2_files/figure-html/traceplot-1.png" alt="Parameters of the AR1 model" width="576"><p class="caption">
Parameters of the AR1 model
</p>
</div>
<p>We can also do a density comparison with the estimated noise and the
true NIG noise:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ngme_out[[1]] means for the 1st replicate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">ngme_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">latents</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">noise</span>,</span>
<span>  <span class="fu"><a href="../reference/ngme_noise.html">noise_nig</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="va">mu</span>, sigma <span class="op">=</span> <span class="va">sigma</span>, nu <span class="op">=</span> <span class="va">nu</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="ngme2_files/figure-html/compare-density-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="paraná-dataset">Paraná dataset<a class="anchor" aria-label="anchor" href="#paran%C3%A1-dataset"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Matrix</span></span>
<span><span class="co">#&gt; Loading required package: foreach</span></span>
<span><span class="co">#&gt; Loading required package: parallel</span></span>
<span><span class="co">#&gt; Loading required package: sp</span></span>
<span><span class="co">#&gt; This is INLA_23.03.19 built 2023-03-19 19:11:44 UTC.</span></span>
<span><span class="co">#&gt;  - See www.r-inla.org/contact-us for how to get help.</span></span>
<span><span class="co">#&gt;  - To enable PARDISO sparse library; see inla.pardiso()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'INLA'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:ngme2':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     f</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.maths.lancs.ac.uk/~rowlings/Splancs/" class="external-link">splancs</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Spatial Point Pattern Analysis Code in S-Plus</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  Version 2 - Spatial and Space-Time analysis</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: viridisLite</span></span></code></pre></div>
<p>The rainfall data from Paraná (Brazil) is collected by the National
Water Agency in Brazil (Agencia Nacional de Águas, ANA, in Portuguese).
ANA collects data from many locations over Brazil, and all these data
are freely available from the ANA website (<a href="http://www3.ana.gov.br/portal/ANA" class="external-link uri">http://www3.ana.gov.br/portal/ANA</a>).</p>
<p>We will briefly illustrate the command we use, and the result of the
estimation.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">PRprec</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">PRborder</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create INLA mesh</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">PRprec</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">prdomain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.nonconvex.hull.html" class="external-link">inla.nonconvex.hull</a></span><span class="op">(</span><span class="va">coords</span>, <span class="op">-</span><span class="fl">0.03</span>, <span class="op">-</span><span class="fl">0.05</span>, resolution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">prmesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.2d.html" class="external-link">inla.mesh.2d</a></span><span class="op">(</span>boundary <span class="op">=</span> <span class="va">prdomain</span>, max.edge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.45</span>, <span class="fl">1</span><span class="op">)</span>, cutoff <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># monthly mean at each location</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">PRprec</span><span class="op">[</span>, <span class="fl">12</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">31</span><span class="op">]</span><span class="op">)</span> <span class="co"># 2 + Octobor</span></span>
<span></span>
<span><span class="va">ind</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="co"># non-NA index</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">Y_mean</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span><span class="va">ind</span><span class="op">]</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">PRprec</span><span class="op">[</span><span class="va">ind</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">seaDist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/spDistsN1.html" class="external-link">spDists</a></span><span class="op">(</span><span class="va">coords</span>, <span class="va">PRborder</span><span class="op">[</span><span class="fl">1034</span><span class="op">:</span><span class="fl">1078</span>, <span class="op">]</span>,</span>
<span>  longlat <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">min</span><span class="op">)</span></span></code></pre></div>
<p>Plot the data:</p>
<div class="figure" style="text-align: center">
<img src="ngme2_files/figure-html/plot-data-1.png" alt="Mean of the rainfall in Octobor 2012 in Paraná" width="576"><p class="caption">
Mean of the rainfall in Octobor 2012 in Paraná
</p>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># leave 0.1 Y as prediction area</span></span>
<span><span class="co"># n &lt;- length(Y)</span></span>
<span><span class="co"># ind_pred &lt;- sample(1:n, size = 0.1 * n)</span></span>
<span><span class="co"># Y_pred &lt;- Y[ind_pred]</span></span>
<span><span class="co"># Y[ind_pred] &lt;- NA</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ngme.html">ngme</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/group.html" class="external-link">inla.group</a></span><span class="op">(</span><span class="va">seaDist</span><span class="op">)</span>, name<span class="op">=</span><span class="st">"rw"</span>, model <span class="op">=</span> <span class="st">"rw"</span>, noise <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_normal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="va">coords</span>, model <span class="op">=</span> <span class="st">"matern"</span>, mesh <span class="op">=</span> <span class="va">prmesh</span>, name<span class="op">=</span><span class="st">"spde"</span>, noise <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_normal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"nig"</span>,</span>
<span>  control_opt <span class="op">=</span> <span class="fu"><a href="../reference/control_opt.html">control_opt</a></span><span class="op">(</span></span>
<span>    estimation <span class="op">=</span> <span class="cn">T</span>,</span>
<span>    iterations <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    n_slope_check <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    stop_points <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    std_lim <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    n_parallel_chain <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    print_check_info <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">16</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting estimation... </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Starting posterior sampling... </span></span>
<span><span class="co">#&gt; Note: Use ngme$latents[[model_name]]$W  to access the posterior mean of process </span></span>
<span><span class="co">#&gt; Posterior sampling done!</span></span>
<span><span class="va">out</span></span>
<span><span class="co">#&gt; *** Ngme object ***</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects: </span></span>
<span><span class="co">#&gt;    beta = 9.14</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Measurement noise: </span></span>
<span><span class="co">#&gt;   Noise type - nig</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       mu = 0.0812</span></span>
<span><span class="co">#&gt;       sigma = 2.22</span></span>
<span><span class="co">#&gt;       nu = 1.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Latent models: </span></span>
<span><span class="co">#&gt; $rw</span></span>
<span><span class="co">#&gt;   Ngme model: rw1</span></span>
<span><span class="co">#&gt;   Model parameters: </span></span>
<span><span class="co">#&gt;       No parameter.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Noise type - normal</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       sigma = 1.05</span></span>
<span><span class="co">#&gt; $spde</span></span>
<span><span class="co">#&gt;   Ngme model: matern</span></span>
<span><span class="co">#&gt;   Model parameters: </span></span>
<span><span class="co">#&gt;       theta_kappa = -0.0127</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Noise type - normal</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       sigma = 1.16</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of replicates is  1</span></span>
<span></span>
<span><span class="co"># traceplots</span></span>
<span><span class="co">## fixed effects and measurement error</span></span>
<span><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
<p><img src="ngme2_files/figure-html/fit-parana-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## spde model</span></span>
<span><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"spde"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ngme2_files/figure-html/fit-parana-2.png" width="700"></p>
<p>Parameter estimation results:</p>
<table style="width:100%;" class="table">
<caption>Estimations for the model</caption>
<colgroup>
<col width="14%">
<col width="13%">
<col width="17%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left">intercept</th>
<th align="left">noise_mu</th>
<th align="left">noise_sigma</th>
<th align="left">noise_nu</th>
<th align="left">rw_sigma</th>
<th align="left">ma_kappa</th>
<th align="left">ma_sigma</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">9.14</td>
<td align="left">0.0812</td>
<td align="left">2.22</td>
<td align="left">1.1</td>
<td align="left">0.0475</td>
<td align="left">0.987</td>
<td align="left">1.16</td>
</tr></tbody>
</table>
<div class="section level3">
<h3 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nxy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">projgrid</span> <span class="op">&lt;-</span> <span class="fu">rSPDE</span><span class="fu">::</span><span class="fu"><a href="https://davidbolin.github.io/rSPDE/reference/rspde.mesh.project.html" class="external-link">rspde.mesh.projector</a></span><span class="op">(</span><span class="va">prmesh</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">PRborder</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">PRborder</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, dims <span class="op">=</span> <span class="va">nxy</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">xy.in</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/splancs/man/inout.html" class="external-link">inout</a></span><span class="op">(</span><span class="va">projgrid</span><span class="op">$</span><span class="va">lattice</span><span class="op">$</span><span class="va">loc</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">PRborder</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">PRborder</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coord.prd</span> <span class="op">&lt;-</span> <span class="va">projgrid</span><span class="op">$</span><span class="va">lattice</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span><span class="va">xy.in</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">coord.prd</span>, type <span class="op">=</span> <span class="st">"p"</span>, cex <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">PRborder</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">coords</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">coords</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ngme2_files/figure-html/predict-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">seaDist.prd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/spDistsN1.html" class="external-link">spDists</a></span><span class="op">(</span><span class="va">coord.prd</span>,</span>
<span>  <span class="va">PRborder</span><span class="op">[</span><span class="fl">1034</span><span class="op">:</span><span class="fl">1078</span>, <span class="op">]</span>,</span>
<span>  longlat <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">min</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># doing prediction by giving the predict location</span></span>
<span><span class="co"># first list is for 1st replicate (we only have 1 replicate)</span></span>
<span><span class="co"># second list is for different latent models (we have 2)</span></span>
<span><span class="va">pds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">out</span>, loc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">seaDist.prd</span>, <span class="va">coord.prd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [[1]] means for the 1st replicate (we only have 1), mean stands for the mean estimator</span></span>
<span><span class="va">lp</span> <span class="op">&lt;-</span> <span class="va">pds</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mean</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">coord.prd</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">coord.prd</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>    colour <span class="op">=</span> <span class="va">lp</span></span>
<span>  <span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">coords</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">coords</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>    colour <span class="op">=</span> <span class="va">Y_mean</span></span>
<span>  <span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PRborder</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">PRborder</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PRborder</span><span class="op">[</span><span class="fl">1034</span><span class="op">:</span><span class="fl">1078</span>, <span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">PRborder</span><span class="op">[</span></span>
<span>    <span class="fl">1034</span><span class="op">:</span><span class="fl">1078</span>,</span>
<span>    <span class="fl">2</span></span>
<span>  <span class="op">]</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ngme2_files/figure-html/predict-2.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="cross-validation">Cross-validation<a class="anchor" aria-label="anchor" href="#cross-validation"></a>
</h3>
<p>We can further validate our model by using cross-validation
method.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cross_validation.html">cross_validation</a></span><span class="op">(</span><span class="va">out</span>, type<span class="op">=</span><span class="st">"k-fold"</span>, k<span class="op">=</span><span class="fl">10</span>, print<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; In group 1 : </span></span>
<span><span class="co">#&gt;       MAE      MSE      CRPS     sCRPS</span></span>
<span><span class="co">#&gt; 1 2.42914 9.600795 -1.302649 -1.387333</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; In group 2 : </span></span>
<span><span class="co">#&gt;        MAE      MSE      CRPS     sCRPS</span></span>
<span><span class="co">#&gt; 1 2.493439 10.53073 -1.304769 -1.428993</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; In group 3 : </span></span>
<span><span class="co">#&gt;        MAE      MSE      CRPS     sCRPS</span></span>
<span><span class="co">#&gt; 1 2.467661 10.01284 -1.325535 -1.365141</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; In group 4 : </span></span>
<span><span class="co">#&gt;        MAE      MSE      CRPS     sCRPS</span></span>
<span><span class="co">#&gt; 1 2.296395 8.895768 -1.205859 -1.410781</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; In group 5 : </span></span>
<span><span class="co">#&gt;        MAE      MSE     CRPS     sCRPS</span></span>
<span><span class="co">#&gt; 1 2.489308 11.61838 -1.38921 -1.324259</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; In group 6 : </span></span>
<span><span class="co">#&gt;       MAE      MSE      CRPS     sCRPS</span></span>
<span><span class="co">#&gt; 1 2.64612 11.37544 -1.520495 -1.333166</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; In group 7 : </span></span>
<span><span class="co">#&gt;       MAE      MSE      CRPS     sCRPS</span></span>
<span><span class="co">#&gt; 1 2.61515 11.10242 -1.420548 -1.348478</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; In group 8 : </span></span>
<span><span class="co">#&gt;       MAE      MSE      CRPS     sCRPS</span></span>
<span><span class="co">#&gt; 1 2.77729 12.82244 -1.554457 -1.444316</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; In group 9 : </span></span>
<span><span class="co">#&gt;        MAE      MSE      CRPS     sCRPS</span></span>
<span><span class="co">#&gt; 1 2.498252 10.27568 -1.291445 -1.468931</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; In group 10 : </span></span>
<span><span class="co">#&gt;        MAE      MSE      CRPS     sCRPS</span></span>
<span><span class="co">#&gt; 1 2.342963 8.717557 -1.244983 -1.389848</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The average of indices computed: </span></span>
<span><span class="co">#&gt;        MAE     MSE      CRPS     sCRPS</span></span>
<span><span class="co">#&gt; 1 2.505572 10.4952 -1.355995 -1.390125</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The final result averaged over replicates: </span></span>
<span><span class="co">#&gt;        MAE     MSE      CRPS     sCRPS</span></span>
<span><span class="co">#&gt; 1 2.505572 10.4952 -1.355995 -1.390125</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Bolin, Xiaotian Jin, Alexandre Simas, Jonas Wallin.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
