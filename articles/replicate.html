<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ngme2 replicates feature â€¢ ngme2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Ngme2 replicates feature">
<meta property="og:description" content="ngme2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ngme2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/ngme2.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Installation_and_configuration.html">Installation and configuration</a>
    </li>
    <li>
      <a href="../articles/inla_compare.html">Comparison with R-INLA</a>
    </li>
    <li>
      <a href="../articles/AR1-model.html">AR(1) model</a>
    </li>
    <li>
      <a href="../articles/RW-model.html">Random walk model</a>
    </li>
    <li>
      <a href="../articles/SPDE-model.html">SPDE Matern model</a>
    </li>
    <li>
      <a href="../articles/replicate.html">Ngme replicate feature</a>
    </li>
    <li>
      <a href="../articles/pred_and_est.html">Model estimation and prediction</a>
    </li>
    <li>
      <a href="../articles/bivariate.html">Bivariate models in Ngme2</a>
    </li>
    <li>
      <a href="../articles/tp-bv.html">Space-time bivariate model in Ngme2</a>
    </li>
    <li>
      <a href="../articles/random-effect.html">Random effects model in Ngme2</a>
    </li>
    <li>
      <a href="../articles/tensor_product.html">Space-time (tensor product) model in Ngme2</a>
    </li>
    <li>
      <a href="../articles/matern-on-graph.html">Matern SPDE model on Metric Graph</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/davidbolin/ngme2" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/jdavidbolin" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Ngme2 replicates feature</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/davidbolin/ngme2/blob/HEAD/vignettes/replicate.Rmd" class="external-link"><code>vignettes/replicate.Rmd</code></a></small>
      <div class="hidden name"><code>replicate.Rmd</code></div>

    </div>

    
    
<p>In this vignette we will introduce the feature of replicates, which
allows to include multiple realizations of the stochastic processes that
can be included in the different models offered in
<code>ngme2</code>.</p>
<div class="section level2">
<h2 id="description">Description<a class="anchor" aria-label="anchor" href="#description"></a>
</h2>
<p>Consider a stochastic process <span class="math inline">\(\mathbf{W}\)</span> indexed by an index set <span class="math inline">\(\mathbf{I}\)</span>, the idea is to allow the
inclusion of replicates of the process in the model.</p>
<p>For example, if one wants to include k realizations of an
autoregressive process of order 1 with <span class="math inline">\(n\)</span> observations in the model one can do so
in the following way</p>
<p><span class="math display">\[\begin{align}
X^{(j)}_1 &amp;= \epsilon^{(j)}_1\\
X^{(j)}_i &amp;= \alpha X^{(j)}_{i-1} + \epsilon^{(j)}_i, i = 2, \
\cdots,\ n
\end{align}\]</span></p>
<p>where <span class="math inline">\(X^{(j)}_i\)</span> denotes the
<span class="math inline">\(i \text{-}th\)</span> observation of <span class="math inline">\(j \text{-}th\)</span> realization of the process
for <span class="math inline">\(i = 1, \ \cdots,\ n\)</span> and <span class="math inline">\(j = 1, \ \cdots,\ k\)</span>, with <span class="math inline">\(|\alpha| &lt; 1\)</span> and <span class="math inline">\(\epsilon^{(j)}_1, \ \cdots \ ,
\epsilon^{(j)}_{n}\)</span> is either i.i.d. <strong>NIG</strong> or
<strong>Gaussian</strong> noise.</p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="section level3">
<h3 id="ar1-model">AR(1) model<a class="anchor" aria-label="anchor" href="#ar1-model"></a>
</h3>
<p>The following example will show how to use the replicates feature for
an AR(1) model.</p>
<p>Suppose one has a response variable with <span class="math inline">\(2n\)</span> observations</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidbolin.github.io/ngme2/">ngme2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; This is ngme2 of version 0.6.0</span></span>
<span><span class="co">#&gt; - See our homepage: https://davidbolin.github.io/ngme2 for more details.</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># creating ar1 process</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">myar</span> <span class="op">&lt;-</span> <span class="fu">ngme2</span><span class="fu">::</span><span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, model<span class="op">=</span><span class="st">"ar1"</span>, rho <span class="op">=</span> <span class="fl">.75</span>, noise <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_nig</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">W1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">myar</span>, seed <span class="op">=</span> <span class="fl">314</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># simulating one realization of the process</span></span>
<span><span class="va">W2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">myar</span>, seed <span class="op">=</span> <span class="fl">159</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># simulating another realization of the process</span></span>
<span></span>
<span><span class="co"># Creating the response variable from the process and adding measurement noise</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">3</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">W1</span>, <span class="va">W2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">n</span>, sd <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Y</span>, idx <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="co"># creating the data frame to fit the model later</span></span></code></pre></div>
<p><img src="replicate_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Note that if both processes are considered as a single one instead of
two realizations of the same process, then the first observation of the
second realization is assumed to be dependent on the last one of the
first process, which might no be desirable in some cases.</p>
<p><img src="replicate_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"></p>
<p>This can be seen in the <span class="math inline">\(\mathbf{K}\)</span> matrix of the model (all the
models in the have the same form <span class="math inline">\(K
\mathbf{W} = \mathbf{\
epsilon}\)</span>), for instance, consider the following little example
to illustrate the last statement.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">no.replicates</span> <span class="op">&lt;-</span> <span class="fu">ngme2</span><span class="fu">::</span><span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, model<span class="op">=</span><span class="st">"ar1"</span>, rho <span class="op">=</span> <span class="fl">.5</span>, noise <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_normal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">replicates</span> <span class="op">&lt;-</span> <span class="fu">ngme2</span><span class="fu">::</span><span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"ar1"</span>,</span>
<span>  rho <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>  noise <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_normal</a></span><span class="op">(</span><span class="op">)</span>, replicate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># K matrix from the model without replicates</span></span>
<span><span class="va">replicates</span><span class="op">$</span><span class="va">operator</span><span class="op">$</span><span class="va">K</span></span>
<span><span class="co">#&gt; 3 x 3 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">#&gt;                       </span></span>
<span><span class="co">#&gt; [1,]  0.8660254  .   .</span></span>
<span><span class="co">#&gt; [2,] -0.5000000  1.0 .</span></span>
<span><span class="co">#&gt; [3,]  .         -0.5 1</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># K matrix from the model with replicates</span></span>
<span><span class="va">no.replicates</span><span class="op">$</span><span class="va">operator</span><span class="op">$</span><span class="va">K</span></span>
<span><span class="co">#&gt; 6 x 6 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">#&gt;                                      </span></span>
<span><span class="co">#&gt; [1,]  0.8660254  .    .    .    .   .</span></span>
<span><span class="co">#&gt; [2,] -0.5000000  1.0  .    .    .   .</span></span>
<span><span class="co">#&gt; [3,]  .         -0.5  1.0  .    .   .</span></span>
<span><span class="co">#&gt; [4,]  .          .   -0.5  1.0  .   .</span></span>
<span><span class="co">#&gt; [5,]  .          .    .   -0.5  1.0 .</span></span>
<span><span class="co">#&gt; [6,]  .          .    .    .   -0.5 1</span></span></code></pre></div>
<p>It is clear how the link between the last observation of the first
process dissapears by looking at the <span class="math inline">\(\mathbf{K}_{4, 3}\)</span> entry of the matrix
<span class="math inline">\(\mathbf{K}\)</span>.</p>
<p>With that being said, one can fit the model using the
<code>ngme</code> function as shown below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fitting the model</span></span>
<span><span class="va">mod.replicates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ngme.html">ngme</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Y</span> <span class="op">~</span> <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"ar1"</span>,</span>
<span>    noise <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_nig</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  replicate <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">group</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df</span>,</span>
<span>  control_opt <span class="op">=</span> <span class="fu"><a href="../reference/control_opt.html">control_opt</a></span><span class="op">(</span></span>
<span>    print_check_info <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting estimation... </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Starting posterior sampling... </span></span>
<span><span class="co">#&gt; Posterior sampling done! </span></span>
<span><span class="co">#&gt; Note:</span></span>
<span><span class="co">#&gt;       1. Use ngme_post_samples(..) to access the posterior samples.</span></span>
<span><span class="co">#&gt;       2. Use ngme_result(..) to access different latent models.</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">mod.replicates</span></span>
<span><span class="co">#&gt; *** Ngme object ***</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects: </span></span>
<span><span class="co">#&gt; (Intercept) </span></span>
<span><span class="co">#&gt;       -3.05 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Models: </span></span>
<span><span class="co">#&gt; $field1</span></span>
<span><span class="co">#&gt;   Model type: AR(1)</span></span>
<span><span class="co">#&gt;       rho = 0.752</span></span>
<span><span class="co">#&gt;   Noise type: NIG</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       mu = -0.0292</span></span>
<span><span class="co">#&gt;       sigma = 1.02</span></span>
<span><span class="co">#&gt;       nu = 1.16</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Measurement noise: </span></span>
<span><span class="co">#&gt;   Noise type: NORMAL</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       sigma = 0.171</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of replicates is  2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="spde-matern-model">SPDE Matern model<a class="anchor" aria-label="anchor" href="#spde-matern-model"></a>
</h3>
<p>The following data is taken from the swamp of Cienaga Grande in Santa
Marta, Colombia. There is a total of 114 locations where some properties
of the swamp were measured. Those measurements were taken twice, however
there is no information available about their chronological order so
this data cannot be treated as spatiotemporal, despite that, the
multiple measurements can be treated as replicates.</p>
<p>In this particular case the temperature is the feature that will be
modeled.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># library(ngme2)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reading the data and the boundary of Cienaga Grande</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">cienaga</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">cienaga.border</span><span class="op">)</span></span>
<span><span class="co"># scale the coords</span></span>
<span><span class="va">cienaga.border</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">cienaga.border</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cienaga</span><span class="op">$</span><span class="va">East</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">cienaga</span><span class="op">$</span><span class="va">East</span><span class="op">)</span></span>
<span><span class="va">cienaga.border</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">cienaga.border</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cienaga</span><span class="op">$</span><span class="va">North</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">cienaga</span><span class="op">$</span><span class="va">North</span><span class="op">)</span></span>
<span><span class="va">cienaga</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">cienaga</span>, <span class="op">{</span></span>
<span>  <span class="va">East_scale</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">East</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">East</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">East</span><span class="op">)</span></span>
<span>  <span class="va">North_scale</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">North</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">North</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">North</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># creating label for the measurement group</span></span>
<span><span class="va">cienaga</span><span class="op">$</span><span class="va">measurement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="op">(</span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cienaga</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="replicate_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"><img src="replicate_files/figure-html/unnamed-chunk-8-2.png" width="672" style="display: block; margin: auto;"></p>
<p>Now we briefly show how to fit the model and how to predict for
locations where the feature is unknown.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># creating the mesh</span></span>
<span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_mesh_2d.html" class="external-link">fm_mesh_2d</a></span><span class="op">(</span></span>
<span>  loc.domain <span class="op">=</span> <span class="va">cienaga.border</span>,</span>
<span>  max.edge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  max.n <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mesh</span><span class="op">$</span><span class="va">n</span></span>
<span><span class="co">#&gt; [1] 457</span></span></code></pre></div>
<p><img src="replicate_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fitting the model</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ngme.html">ngme</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">temp</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">cienaga</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, model <span class="op">=</span> <span class="st">"matern"</span>, mesh<span class="op">=</span><span class="va">mesh</span>,</span>
<span>      name <span class="op">=</span> <span class="st">"spde"</span>, noise <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_nig</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">cienaga</span>,</span>
<span>  replicate<span class="op">=</span><span class="va">cienaga</span><span class="op">$</span><span class="va">measurement</span>,</span>
<span>  control_opt <span class="op">=</span> <span class="fu"><a href="../reference/control_opt.html">control_opt</a></span><span class="op">(</span></span>
<span>    estimation <span class="op">=</span> <span class="cn">T</span>,</span>
<span>    iterations <span class="op">=</span> <span class="fl">500</span>,</span>
<span>    n_slope_check <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    n_parallel_chain <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    print_check_info <span class="op">=</span> <span class="cn">F</span></span>
<span>  <span class="op">)</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">F</span>,</span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting estimation... </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Starting posterior sampling... </span></span>
<span><span class="co">#&gt; Posterior sampling done! </span></span>
<span><span class="co">#&gt; Note:</span></span>
<span><span class="co">#&gt;       1. Use ngme_post_samples(..) to access the posterior samples.</span></span>
<span><span class="co">#&gt;       2. Use ngme_result(..) to access different latent models.</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span></span>
<span><span class="co">#&gt; *** Ngme object ***</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects: </span></span>
<span><span class="co">#&gt; (Intercept) </span></span>
<span><span class="co">#&gt;   -6.28e-14 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Models: </span></span>
<span><span class="co">#&gt; $spde</span></span>
<span><span class="co">#&gt;   Model type: Matern</span></span>
<span><span class="co">#&gt;       kappa = 0.676</span></span>
<span><span class="co">#&gt;   Noise type: NIG</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       mu = 0.693</span></span>
<span><span class="co">#&gt;       sigma = 1.32</span></span>
<span><span class="co">#&gt;       nu = 1.32</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Measurement noise: </span></span>
<span><span class="co">#&gt;   Noise type: NORMAL</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       sigma = 0.998</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of replicates is  2</span></span></code></pre></div>
<p>With the fitted model, one can do predictions as follows.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nxy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">projgrid</span> <span class="op">&lt;-</span> <span class="fu">rSPDE</span><span class="fu">::</span><span class="fu"><a href="https://davidbolin.github.io/rSPDE/reference/rspde.mesh.project.html" class="external-link">rspde.mesh.projector</a></span><span class="op">(</span></span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cienaga.border</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cienaga.border</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  dims <span class="op">=</span> <span class="va">nxy</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">xy.in</span> <span class="op">&lt;-</span> <span class="fu">splancs</span><span class="fu">::</span><span class="fu"><a href="https://rsbivand.github.io/splancs/reference/inout.html" class="external-link">inout</a></span><span class="op">(</span><span class="va">projgrid</span><span class="op">$</span><span class="va">lattice</span><span class="op">$</span><span class="va">loc</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">cienaga.border</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">coord.prd</span> <span class="op">&lt;-</span> <span class="va">projgrid</span><span class="op">$</span><span class="va">lattice</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span><span class="va">xy.in</span>, <span class="op">]</span></span>
<span><span class="va">lp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>spde<span class="op">=</span><span class="va">coord.prd</span><span class="op">)</span><span class="op">)</span> <span class="co"># making the predictions</span></span>
<span></span>
<span><span class="co"># getting the mean of the predictions for each replicate</span></span>
<span><span class="va">preds_mean</span> <span class="op">&lt;-</span> <span class="va">lp</span><span class="op">[[</span><span class="st">"mean"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="replicate_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Bolin, Xiaotian Jin, Alexandre Simas, Jonas Wallin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
