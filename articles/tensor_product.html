<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Space-time (tensor product) model in Ngme2 • ngme2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Space-time (tensor product) model in Ngme2">
<meta property="og:description" content="ngme2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ngme2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/ngme2.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Installation_and_configuration.html">Installation and configuration</a>
    </li>
    <li>
      <a href="../articles/inla_compare.html">Comparison with R-INLA</a>
    </li>
    <li>
      <a href="../articles/AR1-model.html">AR(1) model</a>
    </li>
    <li>
      <a href="../articles/RW-model.html">Random walk model</a>
    </li>
    <li>
      <a href="../articles/SPDE-model.html">SPDE Matern model</a>
    </li>
    <li>
      <a href="../articles/replicate.html">Ngme replicate feature</a>
    </li>
    <li>
      <a href="../articles/pred_and_est.html">Model estimation and prediction</a>
    </li>
    <li>
      <a href="../articles/bivariate.html">Bivariate models in Ngme2</a>
    </li>
    <li>
      <a href="../articles/random-effect.html">Random effects model in Ngme2</a>
    </li>
    <li>
      <a href="../articles/tensor_product.html">Space-time (tensor product) model in Ngme2</a>
    </li>
    <li>
      <a href="../articles/matern-on-graph.html">Matern SPDE model on Metric Graph</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/davidbolin/ngme2" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/jdavidbolin" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Space-time (tensor product) model in Ngme2</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/davidbolin/ngme2/blob/HEAD/vignettes/tensor_product.Rmd" class="external-link"><code>vignettes/tensor_product.Rmd</code></a></small>
      <div class="hidden name"><code>tensor_product.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, we will show how to fit the separable space-time
model (using tensor product structure in <code>ngme2</code>).</p>
<p>The separable space-time model is defined by the Kronecker product
between the precision matrices of the spatial and temporal random
effects. Additional information about separable space-time models can be
found in Cameletti et al. (2013).</p>
</div>
<div class="section level2">
<h2 id="model-structure">Model structure<a class="anchor" aria-label="anchor" href="#model-structure"></a>
</h2>
<p>For the usual model, we have the following structure: <span class="math display">\[ \mathbf{K} \mathbf{X}(s) =
\boldsymbol{\epsilon},\]</span> where <span class="math inline">\(\mathbf{K}\)</span> is some operator matrix, <span class="math inline">\(\boldsymbol{\epsilon}\)</span> represents the
noise (Gaussian or non-Gaussian).</p>
<p>In the tensor product model, the operator matrix <span class="math inline">\(K\)</span> can be constructed by other two
operator matrices of two models:</p>
<p><span class="math display">\[K = K_l \otimes K_r,\]</span> where
<span class="math inline">\(K_l\)</span> and <span class="math inline">\(K_r\)</span> are the operator matrices of the
first and second models, respectively.</p>
</div>
<div class="section level2">
<h2 id="a-toy-example">A toy example<a class="anchor" aria-label="anchor" href="#a-toy-example"></a>
</h2>
<p>To use the space-time model, we need to first define the mesh of the
model, i.e., the discretization of the space-time domain (time <span class="math inline">\(\times\)</span> location). It can be done by
providing the mesh for each. For example, we can provide the same mesh
as in the regular spatial model, and also provide the mesh for the time
index.</p>
<p>The R interface for tensor product model requires map as a list of 2
indices and 2 operators namely <code>first</code> (time) and
<code>second</code> (space) to build the model.</p>
<p>The following is one simple example of how to build the space-time
(2d location) model.</p>
<p>Here the mesh of the model will be ordered according to the order of
the time index (year).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidbolin.github.io/ngme2/">ngme2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="co"># generate time randomly of length n</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2001</span><span class="op">:</span><span class="fl">2004</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># generate 2d location randomly of length n</span></span>
<span><span class="va">loc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># show the time and loc</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">loc</span><span class="op">)</span></span>
<span><span class="co">#&gt;    time        X1       X2</span></span>
<span><span class="co">#&gt; 1  2001 3.1974498 9.676396</span></span>
<span><span class="co">#&gt; 2  2003 5.9111487 8.120988</span></span>
<span><span class="co">#&gt; 3  2003 1.5721967 5.445619</span></span>
<span><span class="co">#&gt; 4  2001 6.6138198 4.306273</span></span>
<span><span class="co">#&gt; 5  2003 5.2534078 2.278224</span></span>
<span><span class="co">#&gt; 6  2003 2.4020197 6.487465</span></span>
<span><span class="co">#&gt; 7  2004 8.4731194 9.513628</span></span>
<span><span class="co">#&gt; 8  2004 6.8851465 9.739844</span></span>
<span><span class="co">#&gt; 9  2002 7.1672573 7.647669</span></span>
<span><span class="co">#&gt; 10 2002 0.7615558 4.748097</span></span>
<span></span>
<span></span>
<span><span class="co"># create the mesh for space (2d location)</span></span>
<span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_mesh_2d.html" class="external-link">fm_mesh_2d</a></span><span class="op">(</span></span>
<span>  loc.domain <span class="op">=</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  max.edge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">)</span></span></code></pre></div>
<p><img src="tensor_product_files/figure-html/setup-1.png" width="700"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># define the space-time model</span></span>
<span><span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu">ngme2</span><span class="fu">::</span><span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span></span>
<span>  map<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">loc</span><span class="op">)</span>, <span class="co"># from the data</span></span>
<span>  model<span class="op">=</span><span class="st">"tp"</span>,</span>
<span>  first<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model<span class="op">=</span><span class="st">"ar1"</span><span class="op">)</span>, <span class="co"># ar1 model for time (mesh generated automatically)</span></span>
<span>  second <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model<span class="op">=</span><span class="st">"matern"</span>, mesh <span class="op">=</span> <span class="va">mesh</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show the model</span></span>
<span><span class="va">m0</span></span>
<span><span class="co">#&gt; Model type: Tensor product</span></span>
<span><span class="co">#&gt;     first: AR(1)</span></span>
<span><span class="co">#&gt;         rho = 0</span></span>
<span><span class="co">#&gt;     second: Matern</span></span>
<span><span class="co">#&gt;         kappa = 1</span></span>
<span><span class="co">#&gt; Noise type: NORMAL</span></span>
<span><span class="co">#&gt; Noise parameters: </span></span>
<span><span class="co">#&gt;     sigma = 1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-ar1-x-matern-2d-example">A AR(1) x Matern 2d example<a class="anchor" aria-label="anchor" href="#a-ar1-x-matern-2d-example"></a>
</h2>
<p>Now let’s turn to simulate and estimate this type of model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##############################  simulation</span></span>
<span><span class="va">mesh2d</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_mesh_2d.html" class="external-link">fm_mesh_2d</a></span><span class="op">(</span></span>
<span>  loc.domain <span class="op">=</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  max.edge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mesh2d</span><span class="op">$</span><span class="va">n</span></span>
<span><span class="co">#&gt; [1] 256</span></span>
<span></span>
<span><span class="co"># generate random loc for each year</span></span>
<span><span class="va">n_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">102</span>, <span class="fl">85</span>, <span class="fl">120</span>, <span class="fl">105</span>, <span class="fl">109</span>, <span class="fl">100</span><span class="op">)</span> <span class="co"># observation for each year</span></span>
<span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2001</span><span class="op">:</span><span class="fl">2006</span>, times <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2d coordinate</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span>;</span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># set the model for simulation</span></span>
<span><span class="va">true_model</span> <span class="op">&lt;-</span> <span class="fu">ngme2</span><span class="fu">::</span><span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span></span>
<span>  map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">year</span>, <span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="va">y</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"tp"</span>,</span>
<span>  first <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model<span class="op">=</span><span class="st">"ar1"</span>, rho <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  second <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model<span class="op">=</span><span class="st">"matern"</span>, mesh <span class="op">=</span> <span class="va">mesh2d</span><span class="op">)</span>,</span>
<span>  noise <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_nig</a></span><span class="op">(</span>mu<span class="op">=</span><span class="op">-</span><span class="fl">2</span>, sigma<span class="op">=</span><span class="fl">1</span>, nu<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">true_model</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">AW</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">true_model</span><span class="op">$</span><span class="va">A</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">W</span><span class="op">)</span></span>
<span><span class="va">Y_obs</span> <span class="op">&lt;-</span> <span class="va">AW</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">AW</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">Y_obs</span><span class="op">)</span></span></code></pre></div>
<p>Next we run the estimation:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##############################  estimation</span></span>
<span><span class="va">ngme_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ngme.html">ngme</a></span><span class="op">(</span></span>
<span>  <span class="va">Y_obs</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span></span>
<span>    map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">year</span>, <span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="va">y</span><span class="op">)</span>,</span>
<span>    model<span class="op">=</span><span class="st">"tp"</span>,</span>
<span>    name<span class="op">=</span><span class="st">"tp"</span>,</span>
<span>    first <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model<span class="op">=</span><span class="st">"ar1"</span><span class="op">)</span>,</span>
<span>    second <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model<span class="op">=</span><span class="st">"matern"</span>, mesh <span class="op">=</span> <span class="va">mesh2d</span><span class="op">)</span>,</span>
<span>    noise <span class="op">=</span> <span class="fu"><a href="../reference/ngme_noise.html">noise_nig</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="co"># control = control_f(numer_grad = T)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"normal"</span>,</span>
<span>  control_opt <span class="op">=</span> <span class="fu"><a href="../reference/control_opt.html">control_opt</a></span><span class="op">(</span></span>
<span>    iterations <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>    n_parallel_chain <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rao_blackwellization <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    preconditioner <span class="op">=</span> <span class="st">"fast"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting estimation... </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Starting posterior sampling... </span></span>
<span><span class="co">#&gt; Posterior sampling done! </span></span>
<span><span class="co">#&gt; Note:</span></span>
<span><span class="co">#&gt;       1. Use ngme_post_samples(..) to access the posterior samples.</span></span>
<span><span class="co">#&gt;       2. Use ngme_result(..) to access different latent models.</span></span>
<span></span>
<span><span class="va">ngme_fit</span></span>
<span><span class="co">#&gt; *** Ngme object ***</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects: </span></span>
<span><span class="co">#&gt;   None</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Models: </span></span>
<span><span class="co">#&gt; $tp</span></span>
<span><span class="co">#&gt;   Model type: Tensor product</span></span>
<span><span class="co">#&gt;       first: AR(1)</span></span>
<span><span class="co">#&gt;           rho = 0.477</span></span>
<span><span class="co">#&gt;       second: Matern</span></span>
<span><span class="co">#&gt;           kappa = 0.868</span></span>
<span><span class="co">#&gt;   Noise type: NIG</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       mu = -0.656</span></span>
<span><span class="co">#&gt;       sigma = 1.25</span></span>
<span><span class="co">#&gt;       nu = 0.709</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Measurement noise: </span></span>
<span><span class="co">#&gt;   Noise type: NORMAL</span></span>
<span><span class="co">#&gt;   Noise parameters: </span></span>
<span><span class="co">#&gt;       sigma = 0.492</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of replicates is  1</span></span></code></pre></div>
<p>To see the results of estimation, we can use <code>traceplot</code>
function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">ngme_fit</span>, <span class="st">"tp"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tensor_product_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compare noise density</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/ngme_noise.html">noise_nig</a></span><span class="op">(</span>mu<span class="op">=</span><span class="op">-</span><span class="fl">2</span>, sigma<span class="op">=</span><span class="fl">1</span>, nu<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="../reference/ngme_result.html">ngme_result</a></span><span class="op">(</span><span class="va">ngme_fit</span>, <span class="st">"tp"</span><span class="op">)</span><span class="op">$</span><span class="va">noise</span><span class="op">)</span></span></code></pre></div>
<p><img src="tensor_product_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># traceplot(ngme_fit)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="doing-prediction">Doing prediction<a class="anchor" aria-label="anchor" href="#doing-prediction"></a>
</h2>
<p>Next we will show how to do prediction at unknown year and
location.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># new predict location</span></span>
<span><span class="va">n_new</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="co"># generate time randomly of length n</span></span>
<span><span class="va">time_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2001</span><span class="op">:</span><span class="fl">2004</span>, <span class="va">n_new</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># generate 2d location randomly of length n</span></span>
<span><span class="va">loc_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_new</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_new</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># For the tp model (model name we give), we need two arguments to do the prediction.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ngme_fit</span>, map<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>tp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  year<span class="op">=</span><span class="va">time_new</span>,</span>
<span>  pos<span class="op">=</span><span class="va">loc_new</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $mean</span></span>
<span><span class="co">#&gt;  [1]  0.03634795 -0.36332160 -0.06028664  0.38393791  0.00000000 -0.28748846</span></span>
<span><span class="co">#&gt;  [7]  0.00000000  0.15092865  0.28868972  0.52669535</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sd</span></span>
<span><span class="co">#&gt;  [1] 0.2464890 0.2578849 0.5174445 0.3187198 0.0000000 0.2691620 0.0000000</span></span>
<span><span class="co">#&gt;  [8] 0.2701588 0.2208944 0.2139089</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`5quantile`</span></span>
<span><span class="co">#&gt;  [1] -0.40801258 -0.74198513 -0.77840206 -0.06917763  0.00000000 -0.82012300</span></span>
<span><span class="co">#&gt;  [7]  0.00000000 -0.29039117 -0.05222943  0.22858346</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`95quantile`</span></span>
<span><span class="co">#&gt;  [1] 0.44130126 0.02112343 0.65403297 0.92479179 0.00000000 0.06951375</span></span>
<span><span class="co">#&gt;  [7] 0.00000000 0.55679218 0.61112249 0.87139234</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $median</span></span>
<span><span class="co">#&gt;  [1]  0.009613149 -0.350774647 -0.114706423  0.368987820  0.000000000</span></span>
<span><span class="co">#&gt;  [6] -0.238606872  0.000000000  0.164825775  0.294053345  0.521707568</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mode</span></span>
<span><span class="co">#&gt;  [1]  0.01013371 -0.33739146 -0.51260086  0.38392885  0.00000000 -0.19059123</span></span>
<span><span class="co">#&gt;  [7]  0.00000000 -0.01837408  0.29601301  0.50299663</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Cameletti, M., Lindgren, F., Simpson, D., &amp; Rue, H. (2013).
Spatio-temporal modeling of particulate matter concentration through the
SPDE approach. AStA Advances in Statistical Analysis, 97(2), 109-131. <a href="https://doi.org/10.1007/s10182-012-0196-3" class="external-link uri">https://doi.org/10.1007/s10182-012-0196-3</a>
</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Bolin, Xiaotian Jin, Alexandre Simas, Jonas Wallin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
