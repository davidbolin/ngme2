test_that("test bv R interface", {
  # test on Matern 2d
  load_all()
  Y1 <- rnorm(5); Y2 <- rnorm(5)
  Y <- cbind(Y1, Y2);

  group <- rep(1:2, each=5)

  mod <- bv(
    m1 = ar1(1:3),
    m2 = ar1(1:3)
  )

  f(model="bv",
    m1=ar1(1:3),
    m2=ar1(1:3),
    map = NULL, mesh = NULL,
    noise = nig(),
    eval=T
  )

  load_all()
# Y1 Y2
# group = factor()

f(~x+y, model="matern")
coordinates()

ngme(
  Y ~ 0 + f(1:5, model="ar1", group="temp") +
   f (model="bv",
    m1=ar1(loc1),
    m2=ar1(loc2),
    replicate = rep(1, 6),
    noise=nig()
  ),
  noise = noise_nig(correlated = TRUE),
  data = list(Y = c(Y1,Y2), group=group, loc1=.., loc2=..),
  control_opt = control_opt(
    iterations = 1,
    n_parallel_chain = 1,
    estimation = T
  )
)

# ngme2
  fm <- Y ~ 0 + f(~1, "fe", group=2) + f(~x1, "re", group=1) + f(
    model="matern2d",
    map=list(1:5, 2:6),
    rho = 0.5, theta = 1,
    kappa1 = 1, kappa2 =1,
    mesh = INLA::inla.mesh.1d(1:10),
    noise = list(noise_nig(), noise_nig()),
    group = c(1,2)
  )

# data =

  out <- ngme(
    fm,
    data = data.frame(
      Y = 1:10,
      x1 = c(1:5, rep(0, 5))
    ),
    group = c(rep(1,5), rep(1,5))
  )

})

test_that("Test on mutlivariate model", {
  library(INLA)
  mesh <- inla.mesh.1d(1:10)
  model_2d(
    a = matern(mesh=mesh),
    b = matern(mesh=mesh),

  )
})