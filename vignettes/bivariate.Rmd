---
title: "Bivariate models in Ngme2"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Bivariate model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Description

In this vignette, we will introduce the bivariate model which supports modeling two field and their correlation jointly.

The `f` function specification is similar to ordinary model, but with two fields.
Extra arguments for the `f` are:

1. `group`: a vector of labels to indicate the group of different observations. If `group` is provided in `ngme()` function, no need to provide in `f()` function again.

2. `sub_models`: characters of length 2 with names equal to one of the labels in `group`, specifying the sub-models for the two fields. e.g. `c(field1="rw1", field2="ar1")`

## Model structure

to-do

## Usage by example

It's better to understand with one exmaple. Say you have an time series model over 5 year from 2001 to 2005, with 2 fields *temperature* and *precipitation*. You want to model the two fields jointly, and their correlation. The data should look like

```{r}
temp <- c(32, 33, 35.5, 36); year_temp <- c(2001, 2002, 2003, 2004)
precip <- c(0.1, 0.2, 0.5, 1, 0.2); year_pre <- c(2001, 2002, 2003, 2004, 2005)

# bind them since we want to model them jointly
y <- c(temp, precip); year <- c(year_temp, year_pre)
labels <- c(rep("temp", 4), rep("precip", 5)) # group is label for 2 fields

data <- data.frame(y, year, labels); data
```

The model specification is

```{r}
load_all()
bv <- f(
  year, model = "bv",
  # sub_models = c(precip="ar1", temp="rw1"),
  # sub_models = list(precip="ar1", temp="rw1"),
  sub_models = list(precip=list(model="ar1", rho=0.5),temp=list(model="rw1")),
  # noise = list(precip="nig", temp="nig"),
  group = labels, # can be provided in ngme()
  eval=T # can be ignored in ngme()
)
bv

list(precip="ar1", temp="rw1")[1]
as.list(c(precip="ar1", temp="rw1"))

```



*Example 1*

The next simple example is a 2d bivariate matern model in the 1d space.

```{r}
```

*Example 2* - models sharing the same parameter?
